#!/bin/bash

POKEMON_LIST=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_URL="https://pokeapi.co/api/v2/pokemon"

for name in "${POKEMON_LIST[@]}"
do
    echo "Fetching data for $name..."
    success=0

    for attempt in {1..3}; do
        echo "Attempt $attempt for $name..."
        http_status=$(curl -s -w "%{http_code}" -o "${name}.json" "${API_URL}/${name}")

        if [ "$http_status" -eq 200 ]; then
            echo "✅ Successfully saved to ${name}.json"
            success=1
            break
        else
            echo "⚠️  Attempt $attempt failed for $name (HTTP $http_status)"
            sleep 2
        fi
    done

    if [ "$success" -eq 0 ]; then
        echo "❌ Failed to fetch $name after 3 attempts" | tee -a errors.txt
        rm -f "${name}.json"  # remove partial/invalid file
    fi

    sleep 2  # Delay before next Pokémon
done
